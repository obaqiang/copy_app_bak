<!DOCTYPE html>
<html class="ui-page-login">

	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />

		<title></title>
		<link href="../../css/mui.min.css" rel="stylesheet" />
		<link href="../../css/style.css" rel="stylesheet" />
		<link rel="stylesheet" type="text/css" href="../../css/icons-extra.css" />
		<link rel="stylesheet" href="../../css/login.css" />
		<style>
			.area {
				margin: 20px auto 0px auto;
			}
			
			.mui-input-group {
				margin-top: 10px;
			}
			
			.mui-input-group:first-child {
				margin-top: 20px;
			}
			
			.mui-input-group label {
				width: 22%;
			}
			
			.mui-input-row label~input,
			.mui-input-row label~select,
			.mui-input-row label~textarea {
				width: 78%;
			}
			
			.mui-checkbox input[type=checkbox],
			.mui-radio input[type=radio] {
				top: 6px;
			}
			
			.mui-content-padded {
				margin-top: 25px;
			}
			
			.mui-btn {
				padding: 10px;
			}
			
			.link-area {
				display: block;
				margin-top: 25px;
				text-align: center;
			}
			
			.spliter {
				color: #bbb;
				padding: 0px 8px;
			}
			
			.oauth-area {
				position: absolute;
				bottom: 20px;
				left: 0px;
				text-align: center;
				width: 100%;
				padding: 0px;
				margin: 0px;
			}
			
			.oauth-area .oauth-btn {
				display: inline-block;
				width: 50px;
				height: 50px;
				background-size: 30px 30px;
				background-position: center center;
				background-repeat: no-repeat;
				margin: 0px 20px;
				/*-webkit-filter: grayscale(100%); */
				border: solid 1px #ddd;
				border-radius: 25px;
			}
			
			.oauth-area .oauth-btn:active {
				border: solid 1px #aaa;
			}
			
			.oauth-area .oauth-btn.disabled {
				background-color: #ddd;
			}
		</style>

	</head>

	<body>
		<header class="mui-bar mui-bar-nav login_vip">
			<h1 class="mui-title">BD贵宾卡</h1>
		</header>
		<div class="login_alert" style="display: none;">
			<img src="../../images/40px_40px_!.png" alt="" />
			<span>手机号码不能为空</span>
		</div>
		<div class="mui-content bg_login">
			<div class="no_login_mask"></div>
			<!--<img src="images/touxiang.jpg" alt="图片不存在" />-->
			<form id='login-form' class="mui-input-group no_line">
				<div class="mui-input-row no_line new_line">
					<label class="login_label">
						<img class="login_tel_icon" src="../../images/40px_50px_tel.png" alt="图片不存在" />
					</label>

					<input id='account' type="text" required="required" class="mui-input-clear mui-input login_text" placeholder="请输入手机号码">
				</div>
				<div class="mui-input-row no_line new_line">
					<label class="login_label">
						<img class="login_lock_icon" src="../../images/40px_50px_lock.png" alt="图片不存在" />
					</label>
					<input id='password' type="password" required="required" class="mui-input-clear mui-input login_text" placeholder="请输入密码">
				</div>
				<div id="identify" class="mui-input-row no_line new_line" style="display: none;">
					<label class="login_label">
						<img class="login_lock_icon" src="../../images/40px_50px_yanzhengma.png" alt="图片不存在" />
					</label>
					<input id='identify_code' type="text" required="required" class="mui-input-clear mui-input login_text" placeholder="请输入验证码">
					<img id="identify_img" class="identify_img" src="" alt="" />
				</div>
			</form>
			<!--<form class="mui-input-group">
				<ul class="mui-table-view mui-table-view-chevron">
					<li class="mui-table-view-cell">
						自动登录
						<div id="autoLogin" class="mui-switch">
							<div class="mui-switch-handle"></div>
						</div>
					</li>
				</ul>
			</form>-->
			<div class=" login_btn">
				<button id="login" class="login_btn_ok">登录</button>
				<div class="link-area">
					<!--<img class="login_nohook_icon" src="images/34px_34px_nohook.png" alt="图片不存在" />-->
					<!--<span class="login_agree">我已阅读并同意</span>
					<span class="login_service">服务信息</span>-->
					<span class="login_forget_pwd">忘记密码？</span>
					<!--<img src="https://api.bdvip.net/api/member/verifycode?phone=13776336512" alt="" />-->
					<!--<a id='reg'>注册账号</a>
					<span class="spliter">|</span> 
					<a id='forgetPassword'>忘记密码</a>-->
				</div>
			</div>
			<!--<div class="mui-content-padded oauth-area">
				<div class="login_bottom_line">
				</div>
				<div class="weixin_login">
					<div class="weixin_po">
						<img class="weixin_icon" src="images/96px_96px_weixin.png" alt="图片不存在" />
						<span class="weixin_text">微信登录</span>
					</div>

				</div>

			</div>-->
			<div class="mui-content-padded oauth-area">

			</div>

		</div>
		<script src="../../js/config/web_config.js"></script>
		<script src="../../js/mui.min.js"></script>
		<script src="../../js/mui.jsonp.js"></script>
		<script src="../../js/mui.enterfocus.js"></script>
		<script src="../../js/app.js"></script>
		<script src="../../js/jquery-1.11.3.js"></script>
		<script src="../../js/common/bdapp.js"></script>
		<script src="../../js/config/web_config.js"></script>
		<script>
			(function($, doc) {
				$.init({
					statusBarBackground: '#f7f7f7'
				});
				//				$.plusReady(function() {
				//					plus.screen.lockOrientation("portrait-primary");
				//					var settings = app.getSettings();
				//					var state = app.getState();
				//					var mainPage = $.preload({
				//						"id": 'main',
				//						"url": 'main.html'
				//					});
				//					var main_loaded_flag = false;
				//					mainPage.addEventListener("loaded", function() {
				//						main_loaded_flag = true;
				//					});
				//					var toMain = function() {
				//						//使用定时器的原因：
				//						//可能执行太快，main页面loaded事件尚未触发就执行自定义事件，此时必然会失败
				//						var id = setInterval(function() {
				//							if(main_loaded_flag) {
				//								clearInterval(id);
				//								$.fire(mainPage, 'show', null);
				//								mainPage.show("pop-in");
				//							}
				//						}, 20);
				//					};
				//					//检查 "登录状态/锁屏状态" 开始
				//					if(settings.autoLogin && state.token && settings.gestures) {
				//						$.openWindow({
				//							url: 'unlock.html',
				//							id: 'unlock',
				//							show: {
				//								aniShow: 'pop-in'
				//							},
				//							waiting: {
				//								autoShow: false
				//							}
				//						});
				//					} else if(settings.autoLogin && state.token) {
				//						toMain();
				//					} else {
				//						app.setState(null);
				//						//第三方登录
				//						var authBtns = ['qihoo', 'weixin', 'sinaweibo', 'qq']; //配置业务支持的第三方登录
				//						var auths = {};
				//						var oauthArea = doc.querySelector('.oauth-area');
				//						plus.oauth.getServices(function(services) {
				//							for(var i in services) {
				//								var service = services[i];
				//								auths[service.id] = service;
				//								if(~authBtns.indexOf(service.id)) {
				//									var isInstalled = app.isInstalled(service.id);
				//									var btn = document.createElement('div');
				//									//如果微信未安装，则为不启用状态
				//									btn.setAttribute('class', 'oauth-btn' + (!isInstalled && service.id === 'weixin' ? (' disabled') : ''));
				//									btn.authId = service.id;
				//									btn.style.backgroundImage = 'url("images/' + service.id + '.png")'
				//									oauthArea.appendChild(btn);
				//								}
				//							}
				//							$(oauthArea).on('tap', '.oauth-btn', function() {
				//								if(this.classList.contains('disabled')) {
				//									plus.nativeUI.toast('您尚未安装微信客户端');
				//									return;
				//								}
				//								var auth = auths[this.authId];
				//								var waiting = plus.nativeUI.showWaiting();
				//								auth.login(function() {
				//									waiting.close();
				//									plus.nativeUI.toast("登录认证成功");
				//									auth.getUserInfo(function() {
				//										plus.nativeUI.toast("获取用户信息成功");
				//										var name = auth.userInfo.nickname || auth.userInfo.name;
				//										app.createState(name, function() {
				//											toMain();
				//										});
				//									}, function(e) {
				//										plus.nativeUI.toast("获取用户信息失败：" + e.message);
				//									});
				//								}, function(e) {
				//									waiting.close();
				//									plus.nativeUI.toast("登录认证失败：" + e.message);
				//								});
				//							});
				//						}, function(e) {
				//							oauthArea.style.display = 'none';
				//							plus.nativeUI.toast("获取登录认证失败：" + e.message);
				//						});
				//					}
				//					// close splash
				//					setTimeout(function() {
				//						//关闭 splash
				//						plus.navigator.closeSplashscreen();
				//					}, 600);
				//					//检查 "登录状态/锁屏状态" 结束
				//					var loginButton = doc.getElementById('login');
				//					var accountBox = doc.getElementById('account');
				//					var passwordBox = doc.getElementById('password');
				//					var autoLoginButton = doc.getElementById("autoLogin");
				//					var regButton = doc.getElementById('reg');
				//					var forgetButton = doc.getElementById('forgetPassword');
				//					loginButton.addEventListener('tap', function(event) {
				//						var loginInfo = {
				//							account: accountBox.value,
				//							password: passwordBox.value
				//						};
				//						app.login(loginInfo, function(err) {
				//							if(err) {
				//								plus.nativeUI.toast(err);
				//								return;
				//							}
				//							toMain();
				//						});
				//					});
				//					$.enterfocus('#login-form input', function() {
				//						$.trigger(loginButton, 'tap');
				//					});
				//					autoLoginButton.classList[settings.autoLogin ? 'add' : 'remove']('mui-active')
				//					autoLoginButton.addEventListener('toggle', function(event) {
				//						setTimeout(function() {
				//							var isActive = event.detail.isActive;
				//							settings.autoLogin = isActive;
				//							app.setSettings(settings);
				//						}, 50);
				//					}, false);
				//					regButton.addEventListener('tap', function(event) {
				//						$.openWindow({
				//							url: 'reg.html',
				//							id: 'reg',
				//							preload: true,
				//							show: {
				//								aniShow: 'pop-in'
				//							},
				//							styles: {
				//								popGesture: 'hide'
				//							},
				//							waiting: {
				//								autoShow: false
				//							}
				//						});
				//					}, false);
				//					forgetButton.addEventListener('tap', function(event) {
				//						$.openWindow({
				//							url: 'forget_password.html',
				//							id: 'forget_password',
				//							preload: true,
				//							show: {
				//								aniShow: 'pop-in'
				//							},
				//							styles: {
				//								popGesture: 'hide'
				//							},
				//							waiting: {
				//								autoShow: false
				//							}
				//						});
				//					}, false);
				//					//
				//					window.addEventListener('resize', function() {
				//						oauthArea.style.display = document.body.clientHeight > 400 ? 'block' : 'none';
				//					}, false);
				//					//
				//					var backButtonPress = 0;
				//					$.back = function(event) {
				//						backButtonPress++;
				//						if(backButtonPress > 1) {
				//							plus.runtime.quit();
				//						} else {
				//							plus.nativeUI.toast('再按一次退出应用');
				//						}
				//						setTimeout(function() {
				//							backButtonPress = 0;
				//						}, 1000);
				//						return false;
				//					};
				//				});
			}(mui, document));
		</script>

		<script>
			//		测试post接口
			//			mui.ajax('https://api.bdvip.net/api/Store/AddStoreShopInfo', {
			//				data: {
			//					location_lat: '31.4295480538',
			//					location_lng: '120.9792681189',
			//					shop_address:'\U5965\U6377\U8def',
			//					shop_id:0,
			//					shop_name:'\U5206\U5e971',
			//					shop_tel:'15377640161',
			//					store_id:842
			//			
			//				},
			//				dataType: 'json', //服务器返回json格式数据
			//				type: 'post', //HTTP请求类型
			//				timeout: 10000, //超时时间设置为10秒；
			//				headers: {
			//					'Content-Type': 'application/json'
			//				},
			//				success: function(data) {
			//					//服务器返回响应，根据响应结果，分析是否登录成功；
			//					console.log(JSON.stringify(data));
			//				},
			//				error: function(xhr, type, errorThrown) {
			//					//异常处理；
			//					console.log(type);
			//				}
			//			});
			//			登陆接口测试
			//			var data_list = {
			//				account: '13032119695',
			//				pwd: '123456'
			//					//jsonp:loginResult
			//			}
			//			var data_need;
			//			BD_getJson('http://localhost/api/member/login',data_list,'get',data_need);
			//			lala();
			//			console.log(data_need);
			//			mui.ajax('http://localhost/api/member/login', {
			//				data: {
			//					account: '13032119695',
			//					pwd: '123456'
			//						//jsonp:loginResult
			//				},
			//				dataType: 'json', //服务器返回json格式数据
			//				type: 'get', //HTTP请求类型
			//				timeout: 10000, //超时时间设置为10秒；
			//				headers: {
			//					'Content-Type': 'application/json',
			//					'Access-Control-Allow-Origin': '*'
			//				},
			//				success: function(data) {
			//					//服务器返回响应，根据响应结果，分析是否登录成功；
			//					console.log(data);
			//				},
			//				error: function(xhr, type, errorThrown) {
			//					//异常处理；
			//					console.log(type);
			//				}
			//			});

			//			var status_data;
			//			function Login(data_account,data_pwd) {
			//				var data_user = {
			//					account: data_account,
			//					pwd: data_pwd
			//				};
			//			mui.getJSONP("http://192.168.1.192/api/member/login", data_user, function(data) {
			//				//服务器返回响应，根据响应结果，分析是否登录成功；
			//				status_data = data;
			//				alert(status_data);
			//				return status_data
			//			});
			//			}

			//			用户名手机密码验证
			//文本框失去焦点后
			var account = 'false';
			var pwd = 'false';
			var identify;

			//			点击图片刷新验证码方法
			//			function img_Re() {
			//				document.getElementById('#identify_img').addEventListener('tap', function() {
			//					var tel = $('#account').val();
			//					var tel_url = 'https://api.bdvip.net/api/member/verifycode?deviceToken=&phone=';
			//					var identify_url = tel_url + tel + new Date().getTime();
			//					$('.identify_img').attr('src', identify_url);
			//				});
			//			}

			$('form :input').blur(function() {
				//验证用户名

				if($(this).is('#account')) {
					if(this.value == "") {
						var errorMsg = '用户名不能为空';
						//						console.log(errorMsg);
						$('.login_alert span').text(errorMsg);
						account = 'false';

					} else {
						account = 'true';
					}
				}
				//验证密码
				if($(this).is('#password')) {
					if(this.value == "") {
						var errorMsg = '密码不能为空';
						//						console.log(errorMsg);
						$('.login_alert span').text(errorMsg);
						pwd = 'false';
					} else {
						pwd = 'true';
					}
				}
				//验证验证码
				if($(this).is('#identify_code')) {
					if(this.value == "") {
						var errorMsg = '我的验证码不能为空';
						//						console.log(errorMsg);
						$('.login_alert span').text(errorMsg);
						identify = 'false';
					} else {
						identify = 'true';

					}
				}

			}).keyup(function() {
				$(this).triggerHandler("blur");

			}).focus(function() {
				$(this).triggerHandler("blur");
			}); //end blur

			function alertHide() {
				$('.login_alert').fadeOut();
				$('.login_vip').fadeIn();
			}

			function loginAlert() {
				$('.login_alert').fadeIn();
				$('.login_vip').fadeOut();
				setTimeout("alertHide()", 2000);
			}

			//			给登陆按钮绑定事件
			document.getElementById('login').addEventListener('tap', function() {
					if(account == 'false') {
						var errorMsg = '用户名不能为空';
						$('.login_alert span').text(errorMsg);
						loginAlert();
					} else if(pwd == 'false') {
						var errorMsg = '密码不能为空';
						$('.login_alert span').text(errorMsg);
						loginAlert();
					} else if(identify == 'false') {
						alert(11);
						var errorMsg = '验证码不能为空';
						$('.login_alert span').text(errorMsg);
						loginAlert();
					} else { //这里请求接口
						//					先判断是否断网
						if(!navigator.onLine) { //如果断网
							//						alert('断网了');
							return;
						}

						var data_list = {};
						data_list.account = $('#account').val();
						data_list.pwd = $('#password').val();
						data_list.VerifyCode = $('#identify_code').val();
						//					console.log('需要的' + data_list.VerifyCode);
						var url_login = test_url + '/api/member/LoginVerify';
						console.log(data_list);
						mui.get(url_login, data_list, function(data) {
							console.log(JSON.stringify(data));
							console.log(data.Data.Member.id);
							if(data.ErrorCode == 4) { //此时需要输入验证码
								var errorMsg = data.ErrorMessage;
								$('.login_alert span').text(errorMsg);
								loginAlert();
								$('#identify').show();
								var tel = $('#account').val();
								var tel_url = 'https://api.bdvip.net/api/member/verifycode?deviceToken=&phone=';
								var identify_url = tel_url + tel + '&' + new Date().getTime();
								$('#identify_img').attr('src', identify_url);
							} else if(data.ErrorCode == 0) { //正常登陆跳转首页
								var webview = mui.openWindow({
									url: '../home/index_main.html',
									extras: {
										member_id: data.Data.Member.id 
									}
								});

							} else { //账号密码错误
								var errorMsg = data.ErrorMessage;
								$('.login_alert span').text(errorMsg);
								loginAlert();
							}

						}, 'json');
						//					bdGetJson(url, data_list, 'jsonp', function(data) {
						//						console.log(data);
						//						if(data.ErrorCode == 4) { //此时需要输入验证码
						//							var errorMsg = data.ErrorMessage;
						//							$('.login_alert span').text(errorMsg);
						//							loginAlert();
						//							$('#identify').show();
						//
						//							var tel = $('#account').val();
						//							var tel_url = 'https://api.bdvip.net/api/member/verifycode?deviceToken=&phone=';
						//							var identify_url = tel_url + tel + '&' + new Date().getTime();
						//							//							console.log(identify_url);
						//							//							alert(22);
						//							//							img_Re();
						//							alert(11);
						//							$('#identify_img').attr('src', identify_url);
						//
						//							//							identify='false';
						//							//							if($('#identify').val()==''){
						//							//								var errorMsg = '验证码不能为空';
						//							//								$('.login_alert span').text(errorMsg);
						//							//							}else{//再次请求登陆接口
						//							//								data_list.VerifyCode=$('#identify').val();
						//							//								bdGetJson(url, data_list, 'jsonp', function(data){
						//							//									console.log('有验证码的'+data);
						//							//								})
						//							//							}
						//
						//						} else if(data.ErrorCode == 0) { //正常登陆跳转首页
						//							//							正常登陆跳转首页
						//
						//						} else { //账号密码错误
						//							var errorMsg = data.ErrorMessage;
						//							$('.login_alert span').text(errorMsg);
						//							loginAlert();
						//						}
						//
						//					});

					}
				})
				//			$('#identify_img').click(function() {
				//				var tel = $('#account').val();
				//				var tel_url = 'https://testapi.bdvip.net/api/member/verifycode?deviceToken=&phone=';
				//
				//				var identify_url = tel_url + tel + new Date().getTime();
				//				//									var identify_url = tel_url + tel;
				//				console.log(identify_url);
				//				$('.identify_img').attr('src', identify_url);
				//			})
		</script>
		<script>
			//各个屏幕大小适配
			(function(doc, win) {
				var docEl = doc.documentElement,
					resizeEvt = 'orientationchange' in window ? 'orientationchange' : 'resize',
					recalc = function() {
						var clientWidth = docEl.clientWidth;
						if(!clientWidth) return;
						docEl.style.fontSize = 100 * (clientWidth / 375) + 'px';
					};

				if(!doc.addEventListener) return;
				win.addEventListener(resizeEvt, recalc, false);
				doc.addEventListener('DOMContentLoaded', recalc, false);
			})(document, window);
		</script>
	</body>

</html>